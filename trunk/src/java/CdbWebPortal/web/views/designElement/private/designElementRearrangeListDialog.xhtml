<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <p:dialog id="designElementRearrangeListDialog" 
              widgetVar="designElementRearrangeListDialogWidget" 
              header="Drag &amp; Drop to change order of design elements." 
              closable="false"
              styleClass="dialog"
              showEffect="fade"
              modal="true"
              resizable="false">
        <div class="dialog">
            <p:dataGrid id="designElementRearrangeListDataGrid" var="designElementObject" value="#{designElementController.sortableDesignElementList}" columns="1" >

                <p:panel id="designElementRearrangeDataGridTopPanel" rendered="#{designElementObject.sortOrder == null || designElementObject.sortOrder == 1}" styleClass="sortDroppable"/>
                <p:panel header="Design Element: #{designElementObject.name}" 
                         id="designElementRearrangeDataGridPanel"
                         toggleable="#{designElementObject.editDesignElementType != ''}"
                         collapsed="true">
                        <h:outputText rendered="#{designElementController.getDisplayChildDesignSelection(designElementObject)}" value="Element type - #{designElementObject.editDesignElementType}: #{designElementObject.childDesign.name}" />
                        <h:outputText rendered="#{designElementController.getDisplayComponentSelection(designElementObject)}" value="Element type - #{designElementObject.editDesignElementType}: #{designElementObject.component.name}" />
                </p:panel>
                <p:panel id="designElementRearrangeDataGridBottomPanel" styleClass="sortDroppable"/>

                <p:draggable for="designElementRearrangeDataGridPanel" revert="true" handle=".ui-panel-titlebar" stack=".ui-panel" opacity=".50" containment="designElementRearrangeListDataGrid" />
                <p:droppable for="designElementRearrangeDataGridTopPanel" tolerance="touch" hoverStyleClass="sortDroppableHover" datasource="designElementRearrangeListDataGrid">
                    <p:ajax listener="#{designElementController.onDesignElementDrop}" 
                            update="designElementRearrangeListDataGrid"
                            oncomplete="updateDesignElementRearrangeFooterButtons()"/>
                </p:droppable>
                <p:droppable for="designElementRearrangeDataGridBottomPanel" tolerance="touch" hoverStyleClass="sortDroppableHover" datasource="designElementRearrangeListDataGrid">
                    <p:ajax listener="#{designElementController.onDesignElementDrop}"
                            update="designElementRearrangeListDataGrid" 
                            oncomplete="updateDesignElementRearrangeFooterButtons()"/>
                </p:droppable>

            </p:dataGrid>

            <f:facet name="footer">

                <p:remoteCommand name="updateDesignElementRearrangeFooterButtons" 
                                 immediate="true"
                                 update="designElementRearrangeDialogSaveAndRefreshButton designElementRearrangeDialogCloseButton"
                                 />

                <p:commandButton id="designElementRearrangeDialogSaveAndRefreshButton"
                                 value="Save &amp; Refresh" alt="Save and refresh page"
                                 disabled="#{!designElementController.getDesignElementPendingChanges()}"
                                 icon="ui-icon-disk"
                                 immediate="true"
                                 action="#{designElementController.saveDesignElementPendingChanges()}"
                                 oncomplete="PF('designElementRearrangeListDialogWidget').hide();"
                                 />

                <p:commandButton id="designElementRearrangeDialogCloseButton"
                                 value="Close" alt="close dialog"
                                 disabled="#{designElementController.getDesignElementPendingChanges()}"
                                 icon="ui-icon-close"
                                 oncomplete="PF('designElementRearrangeListDialogWidget').hide();"
                                 />
            </f:facet>     
        </div>
    </p:dialog>

</ui:composition>
